// Custom routes that don't fit the standard CRUD pattern generated by handlergen.
// These operations have unique URL paths and are registered separately.
package server

import (
	"github.com/go-chi/chi/v5"
	"github.com/matthewbaird/ontology/ent"
	"github.com/matthewbaird/ontology/internal/activity"
	"github.com/matthewbaird/ontology/internal/handler"
)

// RegisterCustomRoutes registers hand-written route mappings for custom
// operations that don't follow the standard CRUD path pattern.
func RegisterCustomRoutes(r chi.Router, client *ent.Client) {
	lh := handler.NewLeaseHandler(client)

	r.Post("/v1/leases/search", lh.SearchLeases)
	r.Get("/v1/leases/{id}/ledger", lh.GetLeaseLedger)
	r.Post("/v1/leases/{id}/payments", lh.RecordPayment)
	r.Post("/v1/leases/{id}/charges", lh.PostCharge)
	r.Post("/v1/leases/{id}/credits", lh.ApplyCredit)
}

// RegisterActivityRoutes registers the signal discovery activity endpoints.
// These use a separate activity.Store, not the Ent client.
func RegisterActivityRoutes(r chi.Router, store activity.Store) {
	ah := handler.NewActivityHandler(store)

	r.Get("/v1/activity/entity/{entity_type}/{entity_id}", ah.HandleGetEntityActivity)
	r.Get("/v1/activity/summary/{entity_type}/{entity_id}", ah.HandleGetSignalSummary)
	r.Post("/v1/activity/portfolio", ah.HandleGetPortfolioSignals)
	r.Post("/v1/activity/search", ah.HandleSearchActivity)
}
